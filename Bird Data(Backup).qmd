---
title: "Bird Data.qmd"
format: html
editor: visual
---

# Bird Data

Bird Survey Data including date, time, surveyors, site, temp, cloud cover, windspeed, survey point, species spotted, and distance

## Load Libraries

```{r}
library(ggplot2)
library(tidyverse)
library(vegan)
```

## Load Data

```{r}
#Load csv files
bird1 <-read.csv("Bird Survey Data - December 2023.csv")
bird2 <-read.csv("Bird Survey Data - February 2024.csv")
```

```{r}
#Merge data sets
bird <- bind_rows(bird1, bird2) 

bird$SiteID<- paste(bird$Site, bird$Point)

bird$Date<-as.Date(bird$Date, "%m/%d/%y")

```

## Species Richness

```{r}
#Summarize count of each bird species found at each site
birdcount <- bird %>%
  group_by(Site, Species, Resident) %>%
  summarise(Count = n()) %>%
  ungroup()

#Add dates for RAI analysis
birdcount_date <- bird %>%
  group_by(Site, Species, Date) %>%
  summarise(Count = n()) %>%
  ungroup()


```

## Log Transformation

```{r}
#Summarize count of each bird species found at each survey point
birdcount_bysite <- bird %>%
  group_by(SiteID, Species) %>%
  summarise(Count = n()) %>%
  ungroup()

#These lines of code add 0 to species that were observed in one siteID but not the others
bird_zero_bysite <- expand.grid(Species = unique(birdcount_bysite$Species), SiteID = unique(birdcount_bysite$SiteID))
bird_zero_bysite <- left_join(bird_zero_bysite, birdcount_bysite, by = c("Species", "SiteID"))
bird_zero_bysite$Count[is.na(bird_zero_bysite$Count)] <- 0
#log transform data
bird_zero_bysite$Countln <- log((bird_zero_bysite$Count)+1)
```

## Calculate Mean and Standard Error

```{r}
#Calculate mean and standard error
birdSD <- bird_zero_bysite |> 
  group_by (SiteID) |>  
  summarise(meanCount = mean(Countln), seCount = sd(Countln)/sqrt(length(Countln))) |>  
  ungroup()
```

## Statistical Analysis

```{r}
#Abundance per species during each site visit
birdcount_byvisit <- bird %>%
  group_by(SiteID, Species, Date) %>%
  summarise(Count = n()) %>%
  ungroup()

#Average bird count per survey point
averages <- birdcount_byvisit %>%
  group_by(SiteID) %>%
  summarise(across(where(is.numeric), mean, na.rm = TRUE))


```

## Graph Avg counts

```{r}
ggplot(bird_zero_bysite, aes(x = SiteID, y = Countln, fill = ifelse(grepl("^BSB", SiteID), "BSB", "CDL"))) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("BSB" = "tan1", "CDL" = "deepskyblue4")) +
  geom_errorbar(data=birdSD, aes(x=SiteID, ymin=meanCount-seCount, ymax=meanCount+seCount))+
  labs(x = "Site", y = "Abundance (log)", title = "Species Abundance by Site") +
  scale_y_continuous(expand = c(0, 0),limits = c(0,10)) +
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5))+
  guides(fill = FALSE)
```

## Shannon-Diversity Index

```{r}
#By Site
birdcount2 <- birdcount %>%
  group_by(Site) %>%
  mutate(Relative_Abundance = Count / sum(Count))

shannon_index <- birdcount2 %>%
  group_by(Site) %>%
  summarize(Shannon_Index = -sum(Relative_Abundance * log(Relative_Abundance)))

#By Survey Point
birdcount2 <- birdcount_byvisit %>%
  group_by(SiteID, Date) %>%
  mutate(Relative_Abundance = Count / sum(Count))

shannon_index <- birdcount2 %>%
  group_by(SiteID, Date) %>%
  summarize(Shannon_Index = -sum(Relative_Abundance * log(Relative_Abundance)))

averages_diversity <- shannon_index %>%
  group_by(SiteID) %>%
  summarise(across(where(is.numeric), mean, na.rm = TRUE))
```

## Graph of Diversity by Site ID

```{r}
#Graph by total in each survey point
ggplot() +
  geom_bar(data = averages_diversity, aes(x = SiteID, y = Shannon_Index, fill = ifelse(grepl("^BSB", SiteID), "BSB", "CDL")), stat = "identity", position = "dodge", color = "black") +
  labs(title = "Species Diversity Comparison Between Survey Points",
       x = "Survey Point", y = "Shannon-Diverity Index") +
  scale_fill_manual(values = c("BSB" = "tan1", "CDL" = "deepskyblue4")) +
  theme(plot.title = element_text(hjust = 0.5))+
  scale_y_continuous(expand = c(0, 0),limits = c(0,2)) + 
  theme_classic()+
  guides(fill = FALSE)

```

## Graph of Species Abundance

```{r}
#These lines of code add 0 to species that were observed in one site but not the other
bird_zero <- expand.grid(Species = unique(birdcount$Species), Site = unique(birdcount$Site))
bird_zero <- left_join(bird_zero, birdcount, by = c("Species", "Site"))
bird_zero$Count[is.na(bird_zero$Count)] <- 0

species_count <- bird_zero %>%
  group_by(Site) %>%
  summarize(Richness = n_distinct(Species))

ggplot() +
  geom_bar(data = bird_zero, aes(x = Species, y = Count, fill = Site), stat = "identity", position = "dodge", color = "black") +
  geom_text(data = species_count, aes(x = 0, y = 0, label = Richness)) +
  labs(title = "Species Abundance Comparison Between Sites",
       x = "Species", y = "Abundance") +
  scale_fill_manual(values = c("BSB" = "tan1", "CDL" = "deepskyblue4")) +
 theme(plot.title = element_text(hjust = 0.5))+
  scale_y_continuous(expand = c(0, 0),limits = c(0,6)) + facet_grid(Site~.)+
  theme_classic()+
  guides(fill = FALSE)
```

## Abundance

```{r}
birdtotal <- bird %>%
  group_by(Site) %>%
  summarise(Count = n()) %>%
  ungroup()
```

## T-Test

```{r}
# Subset data for each site
BSB_data <- birdcount$Count[birdcount$Site == "BSB"]
CDL_data <- birdcount$Count[birdcount$Site == "CDL"]

# Perform t-test
t.test(BSB_data, CDL_data)
```

## Relative Species Abundance

```{r}
birdtotal
```

## Graph of Abundance

```{r}
ggplot(birdcount, aes(x = Site, y = Count, fill=Site)) +
  
  geom_bar(stat = "identity") +
  
  labs(x = "Site", y = "Abundance", title = "Species Abundance by Site") +
  
  scale_fill_manual(values = c("BSB" = "tan1", "CDL" = "deepskyblue4"))+
  
  scale_y_continuous(expand = c(0, 0),limits = c(0,35)) +
  
  theme_classic()+
    
  theme(plot.title = element_text(hjust = 0.5))

```

## Graph of Abundance by Date

```{r}
bird_zero_date <- birdcount_date
bird_zero_date <- left_join(bird_zero_date, birdcount_date, by = c("Species", "Site", "Date"))

bird_zero_date$Count.x[is.na(bird_zero_date$Count.x)] <- 0


ggplot() +
  geom_bar(data = birdcount_date, aes(x = Species, y = Count, fill = Site), stat = "identity",   position = "dodge", color = "black") +
  
  geom_text(data = species_count, aes(x = 0, y = 0, label = Richness)) +
  labs(title = "Species Abundance Comparison Between Sites",
       x = "Species", y = "Abundance") +
  
  scale_fill_manual(values = c("BSB" = "tan1", "CDL" = "deepskyblue4")) +
  
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
 
  scale_y_continuous(expand = c(0, 0),limits = c(0,6)) + 
  
  facet_grid(Site~.)+
  
  scale_x_discrete(breaks = NULL)+
 
  theme_classic()+ 
 
  facet_wrap(Date~., nrow=2)
```

## Migratory vs Resident

```{r}

migratory <- bird %>%
  group_by(Resident, Site) %>%
  summarise(Count = n())

ggplot(migratory, aes(x = Resident, y = Count, fill=Site)) +
  geom_bar(stat = "identity", position="dodge") +
  labs(x="Residency Status", y = "Abundance", 
       title = "Resident vs Migratory Birds by Site") +
  scale_fill_manual(values = c("BSB" = "tan1", "CDL" = "deepskyblue4"))+
  scale_x_discrete(labels = c("No" = "Migratory", "Yes" = "Resident"))+
  scale_y_continuous(expand = c(0, 0), limits = c(0, 25), 
                     labels = scales::number_format(scale = 1, accuracy = 1)) +
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5))

```

## **Bird RAI**

Calculate RAI

RAI = \# occurrences/# days in operation

```{r}
birdRAI <- birdcount_date |> 
  mutate(RAI = Count/2)
 #mutate(MonthYear = mdy(paste(Month,"1",Year,sep = "/"))) 
```

```{r}
#Not the best to represent RAI
birdRAI |> 
  ggplot(aes(y = RAI, x = Date, color = Site)) + 
  geom_point() + 
  geom_line() + 
  facet_wrap(Site ~. )
```
